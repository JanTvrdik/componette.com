server {
  listen 80;
  server_name componette.com www.componette.com;

  return 301 https://componette.com$request_uri;
}

server {
  listen 443;

  server_name www.componette.com;

  ssl_certificate /path/to/cert;
  ssl_certificate_key /path/to/cert;
  ssl_session_timeout 5m;

  return 301 https://componette.com$request_uri;
}

server {
  listen 443 ssl http2;
  server_name componette.com;

  error_log  /var/log/nginx/stable-componette-com-error.log error;

  add_header Content-Security-Policy upgrade-insecure-requests;

  # Nginx > 1.7.5
  # 5184000 => 60 days
  # 15552000 => 180 days
  # 31536000 => 360 days
  add_header Strict-Transport-Security 'max-age=15552000; includeSubDomains; preload' always;

  ssl_certificate /path/to/cert;
  ssl_certificate_key /path/to/cert;
  ssl_session_timeout 5m;

  index index.php;
  root /srv/componette/stable/www;

  charset utf-8;

  location / {
    try_files $uri $uri/ index.php?$args;
  }

  location ~* .+\.(rss|xml)$ {
    try_files $uri index.php?$args;
  }

  location ^~ /imgs {
    try_files $uri $uri/ index.php?$args;
  }

  location ~* \.php$ {
    include        fastcgi.conf;
    fastcgi_pass   php7;

    try_files $uri $uri/ /index.php?$args;
  }

  include parts/caching.conf;
}
